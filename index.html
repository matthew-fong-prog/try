<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydrogen Bond Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0f172a; font-family: 'Inter', sans-serif; }
        canvas { display: block; }
    </style>
</head>
<body class="text-slate-200">

<div class="absolute top-4 left-4 bg-slate-800/80 p-4 rounded-xl backdrop-blur-sm border border-slate-700 max-w-sm z-10">
    <h1 class="text-xl font-bold mb-2 text-cyan-400">Hydrogen Bonds in Water</h1>
    <p class="text-sm mb-3 leading-relaxed">
        Water ($H_2O$) is polar. The Oxygen atom (red) pulls electrons, becoming slightly negative ($\delta-$), while Hydrogens (white) become slightly positive ($\delta+$).
    </p>
    <p class="text-sm leading-relaxed">
        A <strong>Hydrogen Bond</strong> (dashed line) forms between the $\delta+$ Hydrogen of one molecule and the $\delta-$ Oxygen of another. In liquid water, these bonds constantly form and break due to thermal energy.
    </p>
    <div class="mt-4 flex items-center gap-3">
        <span class="text-xs font-mono uppercase text-slate-400">Temperature</span>
        <input type="range" id="tempSlider" min="1" max="10" value="3" class="accent-cyan-500 flex-grow cursor-pointer">
    </div>
</div>

<canvas id="simCanvas"></canvas>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    let width, height;
    let molecules = [];
    const NUM_MOLECULES = 60;

    // Physics constants
    let BASE_SPEED = 0.8;
    const ROTATION_SPEED = 0.02;
    const BOND_DISTANCE = 70; // Distance within which a bond can form
    const O_RADIUS = 14;
    const H_RADIUS = 7;
    const H_OFFSET_DIST = 18; // Distance from O center to H center
    const H_ANGLE_OFFSET = 104.5 * (Math.PI / 180) / 2; // Half of the 104.5 degree bond angle

    class WaterMolecule {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.angle = Math.random() * Math.PI * 2;
            // Random velocity vector based on BASE_SPEED
            this.vx = (Math.random() - 0.5) * BASE_SPEED * 2;
            this.vy = (Math.random() - 0.5) * BASE_SPEED * 2;
            // Random rotational velocity
            this.va = (Math.random() - 0.5) * ROTATION_SPEED;
        }

        update(speedMultiplier) {
            this.x += this.vx * speedMultiplier;
            this.y += this.vy * speedMultiplier;
            this.angle += this.va * speedMultiplier;

            // Bounce off walls
            if (this.x < O_RADIUS) { this.x = O_RADIUS; this.vx *= -1; }
            if (this.x > width - O_RADIUS) { this.x = width - O_RADIUS; this.vx *= -1; }
            if (this.y < O_RADIUS) { this.y = O_RADIUS; this.vy *= -1; }
            if (this.y > height - O_RADIUS) { this.y = height - O_RADIUS; this.vy *= -1; }
        }

        // Calculate absolute positions of the two Hydrogen atoms
        getHydrogens() {
            return [
                {
                    x: this.x + Math.cos(this.angle - H_ANGLE_OFFSET) * H_OFFSET_DIST,
                    y: this.y + Math.sin(this.angle - H_ANGLE_OFFSET) * H_OFFSET_DIST
                },
                {
                    x: this.x + Math.cos(this.angle + H_ANGLE_OFFSET) * H_OFFSET_DIST,
                    y: this.y + Math.sin(this.angle + H_ANGLE_OFFSET) * H_OFFSET_DIST
                }
            ];
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);

            // Draw Oxygen
            ctx.beginPath();
            ctx.arc(0, 0, O_RADIUS, 0, Math.PI * 2);
            // Gradient for 3D effect
            let grdO = ctx.createRadialGradient(-5, -5, 2, 0, 0, O_RADIUS);
            grdO.addColorStop(0, "#ff6b6b");
            grdO.addColorStop(1, "#c0392b");
            ctx.fillStyle = grdO;
            ctx.fill();
            // Slight Charge label
            // ctx.fillStyle = "rgba(0,0,0,0.3)";
            // ctx.font = "10px Arial";
            // ctx.fillText("Î´-", -6, 4);


            // Draw Hydrogens
            // H1
            this.drawHydrogen(
                 Math.cos(-H_ANGLE_OFFSET) * H_OFFSET_DIST,
                 Math.sin(-H_ANGLE_OFFSET) * H_OFFSET_DIST
            );
            // H2
            this.drawHydrogen(
                 Math.cos(H_ANGLE_OFFSET) * H_OFFSET_DIST,
                 Math.sin(H_ANGLE_OFFSET) * H_OFFSET_DIST
            );

            ctx.restore();
        }

        drawHydrogen(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, H_RADIUS, 0, Math.PI * 2);
            let grdH = ctx.createRadialGradient(x-2, y-2, 1, x, y, H_RADIUS);
            grdH.addColorStop(0, "#ffffff");
            grdH.addColorStop(1, "#a0aec0");
            ctx.fillStyle = grdH;
            ctx.fill();
        }
    }

    function init() {
        resize();
        window.addEventListener('resize', resize);

        // Create molecules spread out
        for (let i = 0; i < NUM_MOLECULES; i++) {
            // Try to avoid placing them on top of each other initially
            let safe = false;
            let x, y, attempts = 0;
            while(!safe && attempts < 100) {
                 x = Math.random() * (width - 100) + 50;
                 y = Math.random() * (height - 100) + 50;
                 safe = true;
                 for(let m of molecules) {
                     let d = Math.hypot(m.x - x, m.y - y);
                     if (d < O_RADIUS * 3) safe = false;
                 }
                 attempts++;
            }
            molecules.push(new WaterMolecule(x, y));
        }

        animate();
    }

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }

    function drawBonds() {
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]); // Dashed line for H-bonds

        for (let i = 0; i < molecules.length; i++) {
            let m1 = molecules[i];
            let hPos = m1.getHydrogens();

            // For each molecule, check its Hydrogens against other molecule's Oxygens
            for (let j = 0; j < molecules.length; j++) {
                if (i === j) continue;
                let m2 = molecules[j];

                // Check H1 of m1 -> O of m2
                let d1 = Math.hypot(hPos[0].x - m2.x, hPos[0].y - m2.y);
                if (d1 < BOND_DISTANCE && d1 > O_RADIUS + H_RADIUS) {
                   drawSingleBond(hPos[0].x, hPos[0].y, m2.x, m2.y, d1);
                }

                // Check H2 of m1 -> O of m2
                let d2 = Math.hypot(hPos[1].x - m2.x, hPos[1].y - m2.y);
                if (d2 < BOND_DISTANCE && d2 > O_RADIUS + H_RADIUS) {
                    drawSingleBond(hPos[1].x, hPos[1].y, m2.x, m2.y, d2);
                }
            }
        }
        ctx.setLineDash([]); // Reset
    }

    function drawSingleBond(x1, y1, x2, y2, dist) {
        // Opacity based on distance (stronger when closer)
        const opacity = 1 - Math.pow(dist / BOND_DISTANCE, 3);

        ctx.beginPath();
        ctx.strokeStyle = `rgba(34, 211, 238, ${opacity})`; // cyan-400 with dynamic opacity
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    function animate() {
        ctx.clearRect(0, 0, width, height);

        // Background gradient for "deep water" look
        let bgGrd = ctx.createLinearGradient(0, 0, 0, height);
        bgGrd.addColorStop(0, "#0f172a"); // slate-900
        bgGrd.addColorStop(1, "#1e3a8a"); // blue-900
        ctx.fillStyle = bgGrd;
        ctx.fillRect(0, 0, width, height);

        const speedMultiplier = parseFloat(document.getElementById('tempSlider').value) / 3;

        // Update all positions first
        molecules.forEach(m => m.update(speedMultiplier));

        // Draw bonds *behind* molecules so they don't overlap the atoms weirdly
        drawBonds();

        // Draw molecules on top
        molecules.forEach(m => m.draw());

        requestAnimationFrame(animate);
    }

    init();
</script>
</body>
</html>
